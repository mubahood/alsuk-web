var e,a=Object.defineProperty,s=(e,a,s)=>new Promise(((t,n)=>{var i=e=>{try{c(s.next(e))}catch(a){n(a)}},r=e=>{try{c(s.throw(e))}catch(a){n(a)}},c=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,r);c((s=s.apply(e,a)).next())}));import{j as t,c as n,S as i,A as r,d as c,B as l}from"./vendor-bootstrap.BZxWRyST.js";import{r as o}from"./vendor-react.CSr-5IoM.js";import{h as m,T as d,f as u,C as y}from"./index.Rs0UfOkt.js";class p{static initializePayment(e){return s(this,null,(function*(){try{const a=yield m(`${this.BASE_PATH}/initialize`,e);if(1===a.code&&a.data)return d.info("Redirecting to payment gateway...",{autoClose:3e3}),{success:!0,data:a.data,message:a.message||"Payment initialized successfully"};{const e=a.message||"Failed to initialize payment";return d.paymentError(e),{success:!1,message:e}}}catch(a){const e=a.message||"Failed to initialize payment";return d.paymentError(e),{success:!1,message:e}}}))}static checkPaymentStatus(e){return s(this,null,(function*(){try{const a=yield u(`${this.BASE_PATH}/status/${e}`);return 1===a.code?{success:!0,data:a.data,message:a.message||"Payment status retrieved successfully"}:{success:!1,message:a.message||"Failed to check payment status"}}catch(a){return{success:!1,message:a.message||"Failed to check payment status"}}}))}static testConnectivity(){return s(this,null,(function*(){try{const e=yield m(`${this.BASE_PATH}/test`,{});return{success:1===e.code,message:e.message||"Connectivity test completed"}}catch(e){return{success:!1,message:e.message||"Failed to test connectivity"}}}))}static getPaymentGateways(){return s(this,null,(function*(){var e;try{const a=yield u(`${this.BASE_PATH}/config`);return 1===a.code&&(null==(e=a.data)?void 0:e.payment_gateways)?a.data.payment_gateways:[{id:"pesapal",name:"Pesapal",description:"Pay with Mobile Money, Credit Card, or Bank Transfer",enabled:!0,icon:"bi-credit-card"}]}catch(a){return[{id:"pesapal",name:"Pesapal",description:"Pay with Mobile Money, Credit Card, or Bank Transfer",enabled:!0,icon:"bi-credit-card"}]}}))}static handlePaymentCallback(e,a,s,t){s&&s({orderTrackingId:e,merchantReference:a})}static redirectToPayment(e){window.location.href=e}static openPaymentWindow(e,a=800,s=600){const t=window.screen.width/2-a/2,n=window.screen.height/2-s/2,i=window.open(e,"pesapal_payment",`width=${a},height=${s},left=${t},top=${n},resizable=yes,scrollbars=yes`);return i||(d.error("Popup blocked. Please allow popups and try again, or use direct payment."),this.redirectToPayment(e)),i}static createCallbackUrl(e){return`${window.location.origin}/payment/callback/${e}`}static formatAmount(e,a=y){return new Intl.NumberFormat("en-UG",{style:"currency",currency:a,minimumFractionDigits:0}).format(e)}static getPaymentStatusColor(e){switch(null==e?void 0:e.toUpperCase()){case"COMPLETED":case"SUCCESS":return"success";case"PENDING":case"IN_PROGRESS":return"warning";case"FAILED":case"INVALID":case"ERROR":return"danger";default:return"secondary"}}static getPaymentStatusIcon(e){switch(null==e?void 0:e.toUpperCase()){case"COMPLETED":case"SUCCESS":return"bi-check-circle-fill";case"PENDING":case"IN_PROGRESS":return"bi-clock-fill";case"FAILED":case"INVALID":case"ERROR":return"bi-x-circle-fill";default:return"bi-question-circle-fill"}}}((e,s,t)=>{s in e?a(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t})(p,"symbol"!=typeof(e="BASE_PATH")?e+"":e,"pesapal");const h=({orderId:e,trackingId:a,onStatusUpdate:m,autoRefresh:u=!1,refreshInterval:y=5e3,showActions:h=!0,className:g=""})=>{const[b,x]=o.useState("CHECKING"),[f,N]=o.useState(null),[v,w]=o.useState(!0),[P,j]=o.useState(""),[C,S]=o.useState(new Date);o.useEffect((()=>{E();let e=null;return u&&(e=setInterval((()=>{E(!1)}),y)),()=>{e&&clearInterval(e)}}),[e,u,y]);const E=(a=!0)=>s(void 0,null,(function*(){try{a&&w(!0),j("");const s=yield p.checkPaymentStatus(e);if(s.success&&s.data){const e=s.data.payment_status||"UNKNOWN";x(e),N(s.data),S(new Date),null==m||m(e,s.data),"COMPLETED"===e.toUpperCase()&&a&&d.paymentSuccess()}else{const e=s.message||"Failed to check payment status";j(e),a&&d.error(e)}}catch(s){const e=s.message||"Failed to check payment status";j(e),a&&d.error(e)}finally{a&&w(!1)}})),k=(()=>{switch(b.toUpperCase()){case"COMPLETED":case"SUCCESS":return{variant:"success",icon:"bi-check-circle-fill",title:"Payment Successful",message:"Your payment has been processed successfully."};case"PENDING":case"IN_PROGRESS":return{variant:"warning",icon:"bi-clock-fill",title:"Payment Pending",message:"Your payment is being processed. Please wait..."};case"FAILED":case"INVALID":case"ERROR":return{variant:"danger",icon:"bi-x-circle-fill",title:"Payment Failed",message:(null==f?void 0:f.payment_status_description)||"Payment processing failed. Please try again."};case"CHECKING":return{variant:"info",icon:"bi-arrow-clockwise",title:"Checking Status",message:"Verifying your payment status..."};default:return{variant:"secondary",icon:"bi-question-circle-fill",title:"Unknown Status",message:"Payment status is unclear. Please refresh or contact support."}}})();return v&&"CHECKING"===b?t.jsx(n,{className:`payment-status ${g}`,children:t.jsxs(n.Body,{className:"text-center py-4",children:[t.jsx(i,{animation:"border",variant:"primary"}),t.jsx("h5",{className:"mt-3",children:"Checking Payment Status"}),t.jsx("p",{className:"text-muted mb-0",children:"Please wait while we verify your payment..."})]})}):t.jsxs(n,{className:`payment-status border-${k.variant} ${g}`,children:[t.jsxs(n.Body,{children:[P&&t.jsxs(r,{variant:"danger",dismissible:!0,onClose:()=>j(""),className:"mb-3",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),P]}),t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:`status-icon text-${k.variant} mb-3`,children:t.jsx("i",{className:`bi ${k.icon}`})}),t.jsx("h4",{className:"status-title",children:k.title}),t.jsx("p",{className:"status-message text-muted mb-3",children:k.message}),t.jsx(c,{bg:k.variant,className:"status-badge",children:b.toUpperCase()})]}),f&&t.jsx("div",{className:"payment-details mb-4",children:t.jsxs("div",{className:"details-grid",children:[t.jsxs("div",{className:"detail-item",children:[t.jsx("small",{className:"text-muted",children:"Order ID"}),t.jsxs("div",{className:"fw-semibold",children:["#",e]})]}),a&&t.jsxs("div",{className:"detail-item",children:[t.jsx("small",{className:"text-muted",children:"Tracking ID"}),t.jsx("div",{className:"fw-semibold",children:a})]}),f.amount&&t.jsxs("div",{className:"detail-item",children:[t.jsx("small",{className:"text-muted",children:"Amount"}),t.jsx("div",{className:"fw-semibold",children:p.formatAmount(parseFloat(f.amount),f.currency||"UGX")})]}),f.payment_method&&t.jsxs("div",{className:"detail-item",children:[t.jsx("small",{className:"text-muted",children:"Payment Method"}),t.jsx("div",{className:"fw-semibold",children:f.payment_method})]})]})}),t.jsx("div",{className:"last-checked text-center text-muted mb-3",children:t.jsxs("small",{children:[t.jsx("i",{className:"bi bi-clock me-1"}),"Last checked: ",C.toLocaleTimeString()]})}),h&&t.jsx("div",{className:"payment-actions",children:t.jsxs("div",{className:"d-grid gap-2",children:[t.jsx(l,{variant:"outline-primary",onClick:()=>E(!0),disabled:v,children:v?t.jsxs(t.Fragment,{children:[t.jsx(i,{animation:"border",size:"sm",className:"me-2"}),"Checking..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Refresh Status"]})}),"FAILED"===b.toUpperCase()&&t.jsxs(l,{variant:"warning",onClick:()=>window.location.reload(),children:[t.jsx("i",{className:"bi bi-arrow-repeat me-2"}),"Try Payment Again"]}),"COMPLETED"===b.toUpperCase()&&t.jsxs(l,{variant:"success",onClick:()=>window.location.href="/account/orders",children:[t.jsx("i",{className:"bi bi-list-check me-2"}),"View Orders"]})]})})]}),t.jsx("style",{children:"\n        .payment-status .status-icon {\n          font-size: 3rem;\n          margin-bottom: 1rem;\n        }\n\n        .payment-status .status-title {\n          color: var(--bs-body-color);\n          margin-bottom: 0.5rem;\n        }\n\n        .payment-status .status-badge {\n          font-size: 0.9rem;\n          padding: 0.5rem 1rem;\n        }\n\n        .payment-status .payment-details {\n          background: var(--bs-light, #f8f9fa);\n          border-radius: 8px;\n          padding: 1rem;\n        }\n\n        .payment-status .details-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n          gap: 1rem;\n        }\n\n        .payment-status .detail-item {\n          text-align: center;\n        }\n\n        .payment-status .detail-item small {\n          font-size: 0.75rem;\n          display: block;\n          margin-bottom: 0.25rem;\n        }\n\n        .payment-status .last-checked {\n          font-size: 0.8rem;\n          border-top: 1px solid var(--bs-border-color, #dee2e6);\n          padding-top: 0.75rem;\n        }\n\n        @media (max-width: 576px) {\n          .payment-status .details-grid {\n            grid-template-columns: 1fr 1fr;\n          }\n        }\n      "})]})};export{p as P,h as a};
