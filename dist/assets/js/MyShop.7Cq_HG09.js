var s=(s,e,a)=>new Promise(((t,r)=>{var c=s=>{try{n(a.next(s))}catch(e){r(e)}},i=s=>{try{n(a.throw(s))}catch(e){r(e)}},n=s=>s.done?t(s.value):Promise.resolve(s.value).then(c,i);n((a=a.apply(s,e)).next())}));import{j as e}from"./vendor-bootstrap.BZxWRyST.js";import{r as a}from"./vendor-react.CSr-5IoM.js";import{U as t,D as r,f as c,h as i}from"./index.Cw3mZMWB.js";import{u as n,a as l}from"./vendor-routing.Dz6WPNpl.js";import"./vendor-redux.rUoA4kI-.js";const o=()=>{const o=n(),d=l(),[m,u]=a.useState([]),[h,p]=a.useState(!1),[x,j]=a.useState(""),[v,N]=a.useState(""),[g,b]=a.useState("");a.useEffect((()=>{const s=d.state;(null==s?void 0:s.message)&&(j(s.message),setTimeout((()=>j("")),5e3)),f()}),[]);const f=()=>s(void 0,null,(function*(){var s;try{p(!0),N("");const e=t.loadFromDatabase(r);if(!e||!e.id)return N("Please log in to view your shop"),void o("/auth/login");const a=yield c("products",{my_products:"true",per_page:50});if(1===a.code){const e=(null==(s=a.data)?void 0:s.data)||a.data||[];Array.isArray(e)?u(e):u([])}else N(a.message||"Failed to load products from server"),u([])}catch(e){N(e.message||"Network error - please check your connection"),u([])}finally{p(!1)}})),y=s=>{if(!s)return"/media/svg/files/blank-image.svg";if(s.startsWith("http"))return s;return`http://app.alsukssd.com/storage/images/${s.split("/").pop()||s}`},k=m.filter((s=>s.name.toLowerCase().includes(g.toLowerCase())||s.category_text.toLowerCase().includes(g.toLowerCase())));return e.jsxs("div",{className:"shop-page",children:[e.jsx("div",{className:"shop-header",children:e.jsxs("div",{className:"header-content single-row",children:[e.jsx("h1",{className:"shop-title",children:"Shop Manager"}),e.jsx("div",{className:"shop-filters inline",children:e.jsx("input",{type:"text",className:"search-input",placeholder:"Search...",value:g,onChange:s=>b(s.target.value)})}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{onClick:f,className:"refresh-btn",disabled:h,children:"â†»"}),e.jsx("button",{onClick:()=>o("/account/my-shop/create"),className:"add-product-btn",children:"+ Add"})]})]})}),x&&e.jsxs("div",{className:"notification success",children:[e.jsx("i",{className:"bi-check-circle"}),e.jsx("span",{children:x}),e.jsx("button",{onClick:()=>j(""),className:"close-btn",children:e.jsx("i",{className:"bi-x"})})]}),v&&e.jsxs("div",{className:"notification error",children:[e.jsx("i",{className:"bi-exclamation-circle"}),e.jsx("span",{children:v}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{onClick:()=>N(""),className:"close-btn",children:e.jsx("i",{className:"bi-x"})}),e.jsx("button",{onClick:f,className:"retry-btn",children:"Try Again"})]})]}),e.jsx("div",{className:"shop-container",children:h?e.jsxs("div",{className:"shop-loading",children:[e.jsx("div",{className:"spinner-border"}),e.jsx("p",{children:"Loading your shop..."})]}):0===k.length?e.jsx("div",{className:"shop-empty",children:g?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi-search"}),e.jsx("p",{children:"No products found"}),e.jsx("span",{children:"Try adjusting your search"}),e.jsx("button",{onClick:()=>{b("")},className:"clear-filters-btn",children:"Clear search"})]}):0===m.length?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi-shop"}),e.jsx("p",{children:"No products in your shop yet"}),e.jsx("span",{children:"Start by adding your first product to AL-SUK"}),e.jsx("button",{onClick:()=>o("/account/my-shop/create"),className:"add-first-product-btn",children:"Add Your First Product"})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi-filter"}),e.jsx("p",{children:"No products match your search"}),e.jsx("span",{children:"Try different search terms"}),e.jsx("button",{onClick:()=>{b("")},className:"clear-filters-btn",children:"Clear search"})]})}):e.jsx("div",{className:"products-list list-view",children:k.map((a=>{return e.jsx("div",{className:"product-item minimal list-card",children:e.jsxs("div",{className:"list-card-inner",children:[e.jsx("div",{className:"list-card-image",children:e.jsx("img",{src:y(a.feature_photo),alt:a.name,onError:s=>{s.target.src="/media/svg/files/blank-image.svg"}})}),e.jsxs("div",{className:"list-card-info",children:[e.jsxs("div",{className:"list-card-header",children:[e.jsx("h3",{className:"product-name",children:a.name}),e.jsx("span",{className:"status-badge small "+("1"===a.status?"active":"inactive"),children:"1"===a.status?"Active":"Inactive"})]}),e.jsx("div",{className:"product-price",children:(t=a.price_1,new Intl.NumberFormat("en-UG",{style:"currency",currency:"UGX",minimumFractionDigits:0}).format(parseInt(t)))}),e.jsxs("div",{className:"product-details",children:[e.jsx("span",{className:"product-category",children:a.category_text}),e.jsx("span",{className:"product-location",children:a.supplier})]}),e.jsx("div",{className:"product-description",children:a.description}),e.jsxs("div",{className:"product-meta",children:[e.jsx("span",{className:"stock-status "+("1"===a.in_stock?"in-stock":"out-of-stock"),children:"1"===a.in_stock?"In Stock":"Out of Stock"}),e.jsx("span",{className:"contact-phone",children:a.url})]}),e.jsxs("div",{className:"product-actions minimal",children:[e.jsx("button",{onClick:()=>{return s=a.id,void o(`/account/my-shop/${s}/edit`);var s},className:"action-btn edit-btn",title:"Edit product",children:e.jsx("i",{className:"bi-pencil"})}),e.jsx("button",{onClick:()=>{return e=a.id,s(void 0,null,(function*(){if(window.confirm("Are you sure you want to delete this product?"))try{const s=yield i("products-delete",{id:e.toString()});1===s.code?(u((s=>s.filter((s=>s.id!==e)))),j("Product deleted successfully")):N(s.message||"Failed to delete product")}catch(s){N(s.message||"Failed to delete product")}}));var e},className:"action-btn delete-btn",title:"Delete product",children:e.jsx("i",{className:"bi-trash"})})]})]})]})},a.id);var t}))})})]})};export{o as default};
