var e=(e,s,a)=>new Promise(((t,n)=>{var r=e=>{try{c(a.next(e))}catch(s){n(s)}},i=e=>{try{c(a.throw(e))}catch(s){n(s)}},c=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,i);c((a=a.apply(e,s)).next())}));import{j as s,c as a,S as t,B as n,A as r,R as i,b as c,a as l,N as d}from"./vendor-bootstrap.BZxWRyST.js";import{r as m}from"./vendor-react.CSr-5IoM.js";import{T as o,f as x,C as h}from"./index.Rs0UfOkt.js";import{P as y,a as j}from"./PaymentStatus.Bj6GIymd.js";import{D as p}from"./DynamicBreadcrumb.CJC5BK5i.js";import{c as u,u as b}from"./vendor-routing.Dz6WPNpl.js";import"./vendor-redux.rUoA4kI-.js";const N=({order:l,onPaymentInitialized:d,onError:x,className:h=""})=>{const[j,p]=m.useState([]),[u,b]=m.useState(""),[N,v]=m.useState(!0),[g,f]=m.useState(!1),[w,k]=m.useState("");m.useEffect((()=>{P()}),[]);const P=()=>e(void 0,null,(function*(){try{v(!0),k("");const e=(yield y.getPaymentGateways()).filter((e=>e.enabled));p(e),1===e.length&&b(e[0].id)}catch(e){const s=e.message||"Failed to load payment options";k(s),null==x||x(s)}finally{v(!1)}})),C=e=>{b(e),k("")};return N?s.jsx(a,{className:`payment-gateway-selector ${h}`,children:s.jsxs(a.Body,{className:"text-center py-4",children:[s.jsx(t,{animation:"border",variant:"primary"}),s.jsx("p",{className:"mt-3 mb-0 text-muted",children:"Loading payment options..."})]})}):0===j.length?s.jsx(a,{className:`payment-gateway-selector ${h}`,children:s.jsxs(a.Body,{className:"text-center py-4",children:[s.jsx("i",{className:"bi bi-exclamation-triangle fs-2 text-warning mb-3"}),s.jsx("h5",{children:"No Payment Options Available"}),s.jsx("p",{className:"text-muted mb-3",children:"Payment gateways are currently unavailable. Please contact support."}),s.jsxs(n,{variant:"outline-primary",onClick:P,children:[s.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Retry"]})]})}):s.jsxs(a,{className:`payment-gateway-selector ${h}`,children:[s.jsxs(a.Body,{children:[s.jsxs("div",{className:"d-flex align-items-center mb-4",children:[s.jsx("i",{className:"bi bi-credit-card fs-4 text-primary me-3"}),s.jsxs("div",{children:[s.jsx("h5",{className:"mb-1",children:"Choose Payment Method"}),s.jsx("small",{className:"text-muted",children:"Select your preferred payment option to continue"})]})]}),w&&s.jsxs(r,{variant:"danger",dismissible:!0,onClose:()=>k(""),children:[s.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),w]}),s.jsx(i,{className:"g-3 mb-4",children:j.map((e=>s.jsx(c,{xs:12,children:s.jsx("div",{className:"payment-gateway-option "+(u===e.id?"selected":""),onClick:()=>C(e.id),role:"button",tabIndex:0,onKeyDown:s=>"Enter"===s.key&&C(e.id),children:s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("div",{className:"gateway-radio me-3",children:s.jsx("input",{type:"radio",name:"paymentGateway",value:e.id,checked:u===e.id,onChange:()=>C(e.id),className:"form-check-input"})}),s.jsx("div",{className:"gateway-icon me-3",children:s.jsx("i",{className:`bi ${e.icon||"bi-credit-card"} fs-3 text-primary`})}),s.jsxs("div",{className:"gateway-info flex-grow-1",children:[s.jsx("h6",{className:"mb-1",children:e.name}),s.jsx("small",{className:"text-muted",children:e.description})]}),s.jsx("div",{className:"gateway-arrow",children:s.jsx("i",{className:"bi bi-chevron-right text-muted"})})]})})},e.id)))}),s.jsx("div",{className:"payment-summary mb-4",children:s.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[s.jsx("span",{className:"fw-semibold",children:"Total Amount:"}),s.jsx("span",{className:"fs-5 fw-bold text-primary",children:y.formatAmount(parseFloat(l.payable_amount||l.amount||"0"))})]})}),s.jsx(n,{variant:"primary",size:"lg",className:"w-100",onClick:()=>e(void 0,null,(function*(){if(!u){const e="Please select a payment method";return k(e),void o.error(e)}if(!l||!l.id){const e="Invalid order information";return k(e),void(null==x||x(e))}try{f(!0),k("");const e={order_id:l.id,amount:parseFloat(l.payable_amount||l.amount||"0"),currency:"UGX",customer_name:l.customer_name||"Customer",customer_email:"",customer_phone:l.customer_phone_number_1||"",callback_url:y.createCallbackUrl(l.id),description:`Payment for Order #${l.id}`},s=yield y.initializePayment(e);if(s.success&&s.data)null==d||d(s.data),y.redirectToPayment(s.data.redirect_url);else{const e=s.message||"Failed to initialize payment";k(e),null==x||x(e),o.paymentError(e)}}catch(e){const s=e.message||"Failed to process payment";k(s),null==x||x(s),o.paymentError(s)}finally{f(!1)}})),disabled:!u||g,children:g?s.jsxs(s.Fragment,{children:[s.jsx(t,{animation:"border",size:"sm",className:"me-2"}),"Processing..."]}):s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"bi bi-arrow-right me-2"}),"Proceed to Payment"]})}),s.jsx("div",{className:"trust-indicators mt-4",children:s.jsxs(i,{className:"g-2 text-center",children:[s.jsx(c,{xs:4,children:s.jsxs("div",{className:"trust-item",children:[s.jsx("i",{className:"bi bi-shield-check text-success"}),s.jsx("small",{className:"d-block text-muted",children:"Secure"})]})}),s.jsx(c,{xs:4,children:s.jsxs("div",{className:"trust-item",children:[s.jsx("i",{className:"bi bi-clock text-primary"}),s.jsx("small",{className:"d-block text-muted",children:"Fast"})]})}),s.jsx(c,{xs:4,children:s.jsxs("div",{className:"trust-item",children:[s.jsx("i",{className:"bi bi-check-circle text-success"}),s.jsx("small",{className:"d-block text-muted",children:"Reliable"})]})})]})})]}),s.jsx("style",{children:'\n        .payment-gateway-option {\n          border: 2px solid var(--border-color, #e0e0e0);\n          border-radius: 12px;\n          padding: 16px;\n          transition: all 0.3s ease;\n          cursor: pointer;\n          background: var(--white, white);\n        }\n\n        .payment-gateway-option:hover {\n          border-color: var(--primary-color, #007bff);\n          box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);\n        }\n\n        .payment-gateway-option.selected {\n          border-color: var(--primary-color, #007bff);\n          background: rgba(0, 123, 255, 0.05);\n          box-shadow: 0 2px 12px rgba(0, 123, 255, 0.15);\n        }\n\n        .payment-summary {\n          background: var(--background-light, #f8f9fa);\n          border-radius: 8px;\n          padding: 16px;\n          border: 1px solid var(--border-color, #e0e0e0);\n        }\n\n        .trust-indicators .trust-item {\n          padding: 8px;\n        }\n\n        .trust-indicators .trust-item i {\n          font-size: 1.2rem;\n          margin-bottom: 4px;\n        }\n\n        .gateway-radio input[type="radio"] {\n          width: 18px;\n          height: 18px;\n        }\n      '})]})},v=()=>{const{orderId:y}=u(),v=b(),[g,f]=m.useState(null),[w,k]=m.useState(!0),[P,C]=m.useState(""),[S,_]=m.useState("payment"),[I,F]=m.useState(null),O="+256 701 070684";m.useEffect((()=>{y?A():(C("Order ID is required"),k(!1))}),[y]);const A=()=>e(void 0,null,(function*(){try{k(!0),C("");const e=yield x(`orders/${y}`);if(1===e.code&&e.data){const s=Array.isArray(e.data)?e.data[0]:e.data;f(s),"PAID"===s.payment_confirmation&&(_("status"),o.success("This order has already been paid for!"))}else C(e.message||"Failed to load order details")}catch(e){C(e.message||"Failed to load order details")}finally{k(!1)}}));return w?s.jsx("div",{className:"payment-page",children:s.jsx(l,{className:"py-4",children:s.jsx(i,{className:"justify-content-center",children:s.jsx(c,{lg:6,md:8,children:s.jsx(a,{className:"payment-card",children:s.jsxs(a.Body,{className:"text-center p-5",children:[s.jsx(t,{animation:"border",variant:"primary"}),s.jsx("h5",{className:"mt-3",children:"Loading Order Details"}),s.jsx("p",{className:"text-muted mb-0",children:"Please wait while we fetch your order information..."})]})})})})})}):P&&!g?s.jsx("div",{className:"payment-page",children:s.jsx(l,{className:"py-4",children:s.jsx(i,{className:"justify-content-center",children:s.jsx(c,{lg:6,md:8,children:s.jsx(a,{className:"payment-card",children:s.jsxs(a.Body,{className:"text-center p-5",children:[s.jsx("i",{className:"bi bi-exclamation-triangle fs-1 text-warning mb-3"}),s.jsx("h4",{children:"Unable to Load Order"}),s.jsx("p",{className:"text-muted mb-4",children:P}),s.jsxs("div",{className:"d-grid gap-2",children:[s.jsxs(n,{variant:"primary",onClick:()=>window.location.reload(),children:[s.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Try Again"]}),s.jsxs(n,{variant:"outline-secondary",onClick:()=>v("/account/orders"),children:[s.jsx("i",{className:"bi bi-list-check me-2"}),"View Orders"]})]})]})})})})})}):s.jsx("div",{className:"payment-page",children:s.jsxs(l,{className:"py-4",children:[s.jsx(p,{}),s.jsx(i,{className:"justify-content-center",children:s.jsxs(c,{lg:8,md:10,children:[s.jsxs("div",{className:"payment-header text-center mb-4",children:[s.jsx("h2",{children:"Complete Your Payment"}),s.jsxs("p",{className:"text-muted",children:["Order #",y," â€¢ ",null==g?void 0:g.customer_name]})]}),g&&s.jsx(a,{className:"order-summary-card mb-4",children:s.jsxs(a.Body,{children:[s.jsxs("h6",{className:"fw-bold mb-3",children:[s.jsx("i",{className:"bi bi-receipt me-2"}),"Order Summary"]}),s.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[s.jsx("span",{children:"Order Total:"}),s.jsx("span",{className:"fw-semibold",children:parseFloat(g.order_total||"0").toLocaleString("en-UG",{style:"currency",currency:h})})]}),s.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[s.jsx("span",{children:"Delivery Fee:"}),s.jsx("span",{className:"fw-semibold",children:parseFloat(g.delivery_amount||"0").toLocaleString("en-UG",{style:"currency",currency:h})})]}),s.jsx("hr",{}),s.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[s.jsx("span",{className:"fw-bold",children:"Amount to Pay:"}),s.jsx("span",{className:"fw-bold text-primary fs-5",children:parseFloat(g.payable_amount||g.amount||"0").toLocaleString("en-UG",{style:"currency",currency:h})})]})]})}),s.jsxs(a,{className:"payment-main-card",children:[s.jsx(a.Header,{className:"bg-white",children:s.jsxs(d,{variant:"tabs",activeKey:S,onSelect:e=>_(e),children:[s.jsx(d.Item,{children:s.jsxs(d.Link,{eventKey:"payment",children:[s.jsx("i",{className:"bi bi-credit-card me-2"}),"Online Payment"]})}),s.jsx(d.Item,{children:s.jsxs(d.Link,{eventKey:"status",children:[s.jsx("i",{className:"bi bi-clock-history me-2"}),"Payment Status"]})}),s.jsx(d.Item,{children:s.jsxs(d.Link,{eventKey:"contact",children:[s.jsx("i",{className:"bi bi-telephone me-2"}),"Contact Payment"]})})]})}),s.jsxs(a.Body,{children:[P&&s.jsxs(r,{variant:"danger",dismissible:!0,onClose:()=>C(""),children:[s.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),P]}),"payment"===S&&g&&s.jsxs("div",{className:"payment-tab",children:[s.jsxs("div",{className:"payment-intro mb-4",children:[s.jsx("h5",{children:"Secure Online Payment"}),s.jsx("p",{className:"text-muted",children:"Pay safely with Mobile Money, Credit Card, or Bank Transfer through our secure payment gateway."})]}),s.jsx(N,{order:g,onPaymentInitialized:e=>{F(e),_("status"),o.info("Redirecting to payment gateway...",{autoClose:3e3})},onError:e=>{C(e),o.paymentError(e)}})]}),"status"===S&&y&&s.jsxs("div",{className:"status-tab",children:[s.jsxs("div",{className:"status-intro mb-4",children:[s.jsx("h5",{children:"Payment Status"}),s.jsx("p",{className:"text-muted",children:"Check the current status of your payment and get real-time updates."})]}),s.jsx(j,{orderId:parseInt(y),trackingId:null==I?void 0:I.order_tracking_id,onStatusUpdate:(e,s)=>{"COMPLETED"===e.toUpperCase()&&A()},autoRefresh:!0,refreshInterval:15e3,showActions:!0})]}),"contact"===S&&s.jsxs("div",{className:"contact-tab",children:[s.jsxs("div",{className:"contact-intro text-center mb-4",children:[s.jsx("h5",{children:"Alternative Payment Methods"}),s.jsx("p",{className:"text-muted",children:"For assistance with payment or alternative payment methods, contact us directly."})]}),s.jsxs("div",{className:"contact-number text-center mb-4",children:[s.jsx("div",{className:"contact-label",children:"Contact Number"}),s.jsx("div",{className:"contact-value",children:O})]}),s.jsx("div",{className:"payment-actions",children:s.jsxs("div",{className:"d-grid gap-3",children:[s.jsxs(n,{variant:"primary",size:"lg",onClick:()=>{const e=`tel:${O}`;window.location.href=e},className:"payment-btn",children:[s.jsx("i",{className:"bi bi-telephone-fill me-2"}),"Call to Pay"]}),s.jsxs(n,{variant:"success",size:"lg",onClick:()=>{const e=`Hello, I would like to pay for order #${y}. Please assist me with the payment process.`,s=`https://wa.me/${O.replace(/\D/g,"")}?text=${encodeURIComponent(e)}`;window.open(s,"_blank")},className:"payment-btn",children:[s.jsx("i",{className:"bi bi-whatsapp me-2"}),"WhatsApp Us"]})]})}),s.jsxs("div",{className:"trust-indicators mt-4",children:[s.jsxs("div",{className:"trust-item",children:[s.jsx("i",{className:"bi bi-shield-fill-check"}),s.jsx("span",{children:"Secure Payment"})]}),s.jsxs("div",{className:"trust-item",children:[s.jsx("i",{className:"bi bi-headset"}),s.jsx("span",{children:"24/7 Support"})]}),s.jsxs("div",{className:"trust-item",children:[s.jsx("i",{className:"bi bi-check-circle-fill"}),s.jsx("span",{children:"Instant Processing"})]})]})]})]})]}),s.jsx("div",{className:"text-center mt-4",children:s.jsxs(n,{variant:"outline-secondary",onClick:()=>v("/account/orders"),children:[s.jsx("i",{className:"bi bi-arrow-left me-2"}),"Back to Orders"]})})]})})]})})};export{v as default};
