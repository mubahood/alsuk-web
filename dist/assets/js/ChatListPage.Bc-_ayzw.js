import{j as e}from"./vendor-bootstrap.BZxWRyST.js";import{r as s}from"./vendor-react.CSr-5IoM.js";import{u as a}from"./vendor-redux.rUoA4kI-.js";import{c as t}from"./chatService.ZAEw35NS.js";import{T as r}from"./index.Rs0UfOkt.js";import{u as n}from"./vendor-routing.Dz6WPNpl.js";const i=()=>{const i=n(),c=a((e=>e.auth.user)),[o,l]=s.useState([]),[d,m]=s.useState(!0),[h,u]=s.useState(null);s.useEffect((()=>{(null==c?void 0:c.id)&&j()}),[c]);const j=()=>{return e=void 0,s=null,a=function*(){try{m(!0),u(null);const e=yield t.getChatHeads();if(null==e?void 0:e.data){const s=e.data.sort(((e,s)=>{const a=e.last_message_time?new Date(e.last_message_time).getTime():0;return(s.last_message_time?new Date(s.last_message_time).getTime():0)-a}));l(s)}else l([])}catch(e){const s=e instanceof Error?e.message:"Failed to load conversations";u(s),r.error("Failed to load conversations")}finally{m(!1)}},new Promise(((t,r)=>{var n=e=>{try{c(a.next(e))}catch(s){r(s)}},i=e=>{try{c(a.throw(e))}catch(s){r(s)}},c=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,i);c((a=a.apply(e,s)).next())}));var e,s,a},v=e=>{const s=new Date(e),a=new Date,t=Math.floor((a.getTime()-s.getTime())/6e4);if(t<1)return"Just now";if(t<60)return`${t}m`;const r=Math.floor(t/60);if(r<24)return`${r}h`;const n=Math.floor(r/24);return n<7?`${n}d`:s.toLocaleDateString()};return e.jsxs("div",{className:"chat-list-page",children:[e.jsxs("div",{className:"chat-list-header",children:[e.jsx("h1",{className:"chat-list-title",children:"Messages"}),e.jsx("button",{onClick:j,className:"chat-refresh-btn",disabled:d,children:e.jsx("i",{className:"bi-arrow-clockwise"})})]}),h&&e.jsxs("div",{className:"chat-error-banner",children:[e.jsx("span",{children:h}),e.jsx("button",{onClick:j,className:"retry-btn",children:"Retry"})]}),e.jsx("div",{className:"chat-list-container",children:d?e.jsxs("div",{className:"chat-loading",children:[e.jsx("div",{className:"spinner-border",role:"status"}),e.jsx("p",{children:"Loading conversations..."})]}):0===o.length?e.jsxs("div",{className:"chat-empty",children:[e.jsx("i",{className:"bi-chat-heart"}),e.jsx("p",{children:"No conversations yet"}),e.jsx("span",{children:"Start chatting with sellers!"})]}):e.jsx("div",{className:"chat-conversations",children:o.map((s=>{const a=(e=>(null==c?void 0:c.id)?c.id.toString()===e.customer_id?e.product_owner_name||"Unknown User":e.customer_name||"Unknown User":"Unknown User")(s),t=a.split(" ").map((e=>e.charAt(0))).join("").substring(0,2).toUpperCase();return e.jsxs("div",{className:"chat-item",onClick:()=>(e=>{i(`/account/chat/${e.id}`)})(s),children:[e.jsx("div",{className:"chat-avatar",children:t}),e.jsxs("div",{className:"chat-content",children:[e.jsxs("div",{className:"chat-header",children:[e.jsx("h3",{className:"chat-name",children:a}),s.last_message_time&&e.jsx("span",{className:"chat-time",children:v(s.last_message_time)})]}),s.product_name&&e.jsxs("div",{className:"chat-product",children:[e.jsx("i",{className:"bi-box-seam"}),e.jsx("span",{children:s.product_name})]}),e.jsx("div",{className:"chat-last-message",children:s.last_message_body||"Start the conversation"})]}),e.jsx("div",{className:"chat-arrow",children:e.jsx("i",{className:"bi-chevron-right"})})]},s.id)}))})})]})};export{i as default};
