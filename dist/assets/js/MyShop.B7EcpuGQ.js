var s=(s,e,a)=>new Promise(((t,r)=>{var c=s=>{try{n(a.next(s))}catch(e){r(e)}},i=s=>{try{n(a.throw(s))}catch(e){r(e)}},n=s=>s.done?t(s.value):Promise.resolve(s.value).then(c,i);n((a=a.apply(s,e)).next())}));import{j as e}from"./vendor-bootstrap.BZxWRyST.js";import{r as a}from"./vendor-react.CSr-5IoM.js";import{U as t,E as r,f as c,h as i,C as n}from"./index.Rs0UfOkt.js";import{u as l,a as o}from"./vendor-routing.Dz6WPNpl.js";import"./vendor-redux.rUoA4kI-.js";const d=()=>{const d=l(),m=o(),[u,h]=a.useState([]),[p,x]=a.useState(!1),[j,v]=a.useState(""),[N,g]=a.useState(""),[b,f]=a.useState("");a.useEffect((()=>{const s=m.state;(null==s?void 0:s.message)&&(v(s.message),setTimeout((()=>v("")),5e3)),y()}),[]);const y=()=>s(void 0,null,(function*(){var s;try{x(!0),g("");const e=t.loadFromDatabase(r);if(!e||!e.id)return g("Please log in to view your shop"),void d("/auth/login");const a=yield c("products",{my_products:"true",per_page:50});if(1===a.code){const e=(null==(s=a.data)?void 0:s.data)||a.data||[];Array.isArray(e)?h(e):h([])}else g(a.message||"Failed to load products from server"),h([])}catch(e){g(e.message||"Network error - please check your connection"),h([])}finally{x(!1)}})),k=s=>{if(!s)return"/media/svg/files/blank-image.svg";if(s.startsWith("http"))return s;return`http://app.alsukssd.com/storage/images/${s.split("/").pop()||s}`},C=u.filter((s=>s.name.toLowerCase().includes(b.toLowerCase())||s.category_text.toLowerCase().includes(b.toLowerCase())));return e.jsxs("div",{className:"shop-page",children:[e.jsx("div",{className:"shop-header",children:e.jsxs("div",{className:"header-content single-row",children:[e.jsx("h1",{className:"shop-title",children:"Shop Manager"}),e.jsx("div",{className:"shop-filters inline",children:e.jsx("input",{type:"text",className:"search-input",placeholder:"Search...",value:b,onChange:s=>f(s.target.value)})}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{onClick:y,className:"refresh-btn",disabled:p,children:"â†»"}),e.jsx("button",{onClick:()=>d("/account/my-shop/create"),className:"add-product-btn",children:"+ Add"})]})]})}),j&&e.jsxs("div",{className:"notification success",children:[e.jsx("i",{className:"bi-check-circle"}),e.jsx("span",{children:j}),e.jsx("button",{onClick:()=>v(""),className:"close-btn",children:e.jsx("i",{className:"bi-x"})})]}),N&&e.jsxs("div",{className:"notification error",children:[e.jsx("i",{className:"bi-exclamation-circle"}),e.jsx("span",{children:N}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{onClick:()=>g(""),className:"close-btn",children:e.jsx("i",{className:"bi-x"})}),e.jsx("button",{onClick:y,className:"retry-btn",children:"Try Again"})]})]}),e.jsx("div",{className:"shop-container",children:p?e.jsxs("div",{className:"shop-loading",children:[e.jsx("div",{className:"spinner-border"}),e.jsx("p",{children:"Loading your shop..."})]}):0===C.length?e.jsx("div",{className:"shop-empty",children:b?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi-search"}),e.jsx("p",{children:"No products found"}),e.jsx("span",{children:"Try adjusting your search"}),e.jsx("button",{onClick:()=>{f("")},className:"clear-filters-btn",children:"Clear search"})]}):0===u.length?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi-shop"}),e.jsx("p",{children:"No products in your shop yet"}),e.jsx("span",{children:"Start by adding your first product to AL-SUK"}),e.jsx("button",{onClick:()=>d("/account/my-shop/create"),className:"add-first-product-btn",children:"Add Your First Product"})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi-filter"}),e.jsx("p",{children:"No products match your search"}),e.jsx("span",{children:"Try different search terms"}),e.jsx("button",{onClick:()=>{f("")},className:"clear-filters-btn",children:"Clear search"})]})}):e.jsx("div",{className:"products-list list-view",children:C.map((a=>{return e.jsx("div",{className:"product-item minimal list-card",children:e.jsxs("div",{className:"list-card-inner",children:[e.jsx("div",{className:"list-card-image",children:e.jsx("img",{src:k(a.feature_photo),alt:a.name,onError:s=>{s.target.src="/media/svg/files/blank-image.svg"}})}),e.jsxs("div",{className:"list-card-info",children:[e.jsxs("div",{className:"list-card-header",children:[e.jsx("h3",{className:"product-name",children:a.name}),e.jsx("span",{className:"status-badge small "+("1"===a.status?"active":"inactive"),children:"1"===a.status?"Active":"Inactive"})]}),e.jsx("div",{className:"product-price",children:(t=a.price_1,new Intl.NumberFormat("en-UG",{style:"currency",currency:n,minimumFractionDigits:0}).format(parseInt(t)))}),e.jsxs("div",{className:"product-details",children:[e.jsx("span",{className:"product-category",children:a.category_text}),e.jsx("span",{className:"product-location",children:a.supplier})]}),e.jsx("div",{className:"product-description",children:a.description}),e.jsxs("div",{className:"product-meta",children:[e.jsx("span",{className:"stock-status "+("1"===a.in_stock?"in-stock":"out-of-stock"),children:"1"===a.in_stock?"In Stock":"Out of Stock"}),e.jsx("span",{className:"contact-phone",children:a.url})]}),e.jsxs("div",{className:"product-actions minimal",children:[e.jsx("button",{onClick:()=>{return s=a.id,void d(`/account/my-shop/${s}/edit`);var s},className:"action-btn edit-btn",title:"Edit product",children:e.jsx("i",{className:"bi-pencil"})}),e.jsx("button",{onClick:()=>{return e=a.id,s(void 0,null,(function*(){if(window.confirm("Are you sure you want to delete this product?"))try{const s=yield i("products-delete",{id:e.toString()});1===s.code?(h((s=>s.filter((s=>s.id!==e)))),v("Product deleted successfully")):g(s.message||"Failed to delete product")}catch(s){g(s.message||"Failed to delete product")}}));var e},className:"action-btn delete-btn",title:"Delete product",children:e.jsx("i",{className:"bi-trash"})})]})]})]})},a.id);var t}))})})]})};export{d as default};
